# Автоматический парсинг SEO позиций

## Описание

Система автоматического парсинга позиций работает на основе настроек расписания для каждого сайта. Парсинг запускается согласно расписанию, настроенному пользователем.

## Команда

```bash
php artisan seo:run-scheduled-parsing [--force]
```

### Параметры:
- `--force` - Запустить парсинг для всех сайтов независимо от расписания

## Настройка расписания

### Типы расписания:

1. **По требованию** - парсинг запускается только вручную
2. **День недели** - парсинг запускается в определенные дни недели в указанное время
3. **День месяца** - парсинг запускается в определенные дни месяца в указанное время

### Примеры настроек:

#### Еженедельно (понедельник, среда, пятница в 09:00):
```json
{
  "type": "weekly",
  "time": "09:00",
  "days": [1, 3, 5]
}
```

#### Ежедневно (каждый день в 10:30):
```json
{
  "type": "monthly",
  "time": "10:30",
  "monthDays": ["*"]
}
```

#### По дням месяца (1, 15, 28 число в 14:00):
```json
{
  "type": "monthly",
  "time": "14:00",
  "monthDays": [1, 15, 28]
}
```

## Настройка Cron

Для автоматического запуска добавьте в crontab:

```bash
# Проверка расписания каждую минуту
* * * * * cd /path/to/project && php artisan seo:run-scheduled-parsing >> storage/logs/scheduled-parsing.log 2>&1
```

### Установка cron задачи:

1. Откройте crontab:
```bash
crontab -e
```

2. Добавьте строку:
```bash
* * * * * cd /var/www && php artisan seo:run-scheduled-parsing >> /var/www/storage/logs/scheduled-parsing.log 2>&1
```

3. Сохраните и выйдите

## Логи

Логи парсинга сохраняются в:
- Консольный вывод команды
- `storage/logs/scheduled-parsing.log` (если настроен cron)

## Мониторинг

Для мониторинга работы системы:

1. Проверьте логи:
```bash
tail -f storage/logs/scheduled-parsing.log
```

2. Запустите команду вручную для тестирования:
```bash
php artisan seo:run-scheduled-parsing --force
```

## Устранение неполадок

### Парсинг не запускается:
1. Проверьте настройки расписания сайта
2. Убедитесь, что у сайта есть ключевые слова
3. Проверьте подключение к микросервису
4. Проверьте логи ошибок

### Cron не работает:
1. Проверьте права доступа к файлам
2. Убедитесь, что путь к проекту правильный
3. Проверьте логи cron: `/var/log/cron` или `/var/log/syslog`
