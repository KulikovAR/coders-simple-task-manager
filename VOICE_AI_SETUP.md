# Настройка голосового ИИ-ассистента в Telegram

## Описание

Добавлена возможность общения с ИИ-ассистентом через голосовые сообщения в Telegram. Система автоматически конвертирует голос в текст с помощью OpenAI Whisper API и передает запрос существующему ИИ-ассистенту.

## Новые сервисы

### VoiceToTextService
- Конвертирует голосовые сообщения в текст
- Использует OpenAI Whisper API для распознавания речи
- Поддерживает конвертацию через ffmpeg
- Очищает временные файлы

### TelegramVoiceService
- Обрабатывает голосовые сообщения в Telegram
- Интегрируется с существующим AI ассистентом
- Проверяет права пользователя и лимиты
- Отправляет уведомления о процессе обработки

## Настройка

### 1. Переменные окружения

Добавьте в `.env` файл:

```env
# OpenAI API для Whisper
OPENAI_API_KEY=your_openai_api_key_here
OPENAI_API_URL=https://api.openai.com/v1
```

### 2. Установка ffmpeg

Убедитесь, что ffmpeg установлен на сервере:

```bash
# Ubuntu/Debian
sudo apt update
sudo apt install ffmpeg

# CentOS/RHEL
sudo yum install ffmpeg

# macOS
brew install ffmpeg
```

### 3. Права доступа

Убедитесь, что веб-сервер имеет права на запись в директорию `storage/app/temp/voice`:

```bash
mkdir -p storage/app/temp/voice
chmod 755 storage/app/temp/voice
chown www-data:www-data storage/app/temp/voice  # для Apache
# или
chown nginx:nginx storage/app/temp/voice        # для Nginx
```

## Использование

### Для пользователей

1. Отправьте голосовое сообщение боту в Telegram
2. Бот автоматически:
   - Скачает голосовое сообщение
   - Конвертирует его в текст с помощью Whisper
   - Покажет распознанный текст
   - Отправит запрос ИИ-ассистенту
   - Вернет ответ от ИИ

### Поддерживаемые форматы

- OGG (основной формат Telegram)
- MP3
- WAV
- M4A
- WebM

### Ограничения

- Максимальная длительность: 5 минут
- Требуется привязанный аккаунт (senderId в профиле)
- Учитываются лимиты ИИ-запросов по тарифу

## Логирование

Все операции логируются в Laravel лог:

- Успешная обработка голосовых сообщений
- Ошибки конвертации и распознавания
- Ошибки API OpenAI
- Ошибки Telegram API

## Безопасность

- Временные файлы автоматически удаляются после обработки
- Проверка прав пользователя перед обработкой
- Валидация форматов и размеров файлов
- Обработка ошибок с информативными сообщениями

## Мониторинг

Для мониторинга работы системы проверяйте логи:

```bash
tail -f storage/logs/laravel.log | grep -i voice
```

## Обновление справки

Справка бота автоматически обновлена и включает информацию о голосовых сообщениях:

- `/start` - показывает возможности голосового общения
- Эхо-сообщения содержат инструкции по использованию голоса
